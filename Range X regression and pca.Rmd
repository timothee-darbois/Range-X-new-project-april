---
title: "range X regression"
author: "Timothée Darbois"
date: "2024-02-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(ade4)
library(ggplot2)
library(tidyverse)
library(googlesheets4)
library(dplyr)
library(rstatix)
library(readxl)
library(Factoshiny)
library(vegan)
library(missMDA)
library(ggvegan)
library(ggordiplots)
library(GGally)
library(patchwork)
library(jtools)
library(lme4)
library(interactions)
library(multcomp)
library(effects)
library(ggeffects)


```

```{r}
df_Tim<-read.csv('D:/mes_documents/M1/stage/data/csv/rangeX seeds even number (2).xlsx - Feuille 1.csv',dec=",", na.strings = c("#DIV/0!"))

df_Tim<-as.data.frame(df_Tim)
df_Tim<- df_Tim %>% mutate(student='Timothée')

df_Tim<-df_Tim %>% mutate(condi=paste(df_Tim$site,df_Tim$plotID,sep=","))

```

```{r}
df_Ingrid<-read.csv('D:/mes_documents/M1/stage/data/csv/Copie de Seeds rangeX Timothée - Seeds odd numbers.csv', dec=",", na.strings = c("#DIV/0!"))
df_Ingrid<-as.data.frame(df_Ingrid)
df_Ingrid<- df_Ingrid %>% mutate(student='Ingrid')


```
  

```{r}
df1<-df_Tim%>% dplyr::select(1,2,3,4,5,6,7,8,9,10,11,12,13,"student")
df2<-df_Ingrid%>% dplyr::select(1,2,3,4,5,6,7,8,9,10,11,12,13,"student")
df<-rbind(df1,df2)

df<-df %>% mutate(seeds_number.inf=as.integer(seeds_number.inf))

df<-df%>%
  filter(!is.na(weight.inf))

df<-df %>% mutate(condi=paste(df$site,df$plotID,sep=","))

df<-df %>% mutate(merge_ID=paste(df$site,df$blockID,df$plotID,df$positionID_clean, sep=" "))

```

removing na from the column seed weight, and preparing columnb for log ( adding small constant to avoid 0)
```{r}
df$weight.seed[is.na(df$weight.seed)]<-0
c<-which(df$weight.inf!= 0)
c1<-min(df$weight.inf[c])/100

c<-which(df$weight.seed!= 0)
c2<-min(df$weight.seed[c])/100

df<-data.frame(df,weight.inf.log=df$weight.inf+c1,weight.seed.log=df$weight.seed+c2)
```

```{r}
df<-data.frame(df,temperature=paste(df$treat1,df$site))
df$temperature<-str_replace(df$temperature,"LS","ambient LS")
```

```{r}
demo_trait_high<-read_excel(path="C:/Users/timot/Documents/M1/stage/data_analysis/data/RangeX_raw_demographic_traits_high_2023.xlsx",sheet=2)
demo_trait_low<-read_excel(path="C:/Users/timot/Documents/M1/stage/data_analysis/data/RangeX_raw_demographic_traits_low_2023.xlsx",sheet=2)
func_trait<-read_excel(path="C:/Users/timot/Documents/M1/stage/data_analysis/data/RangeX_raw_functional_traits_2023.xlsx",sheet=2)

```

```{r}
demo_trait_high<-demo_trait_high %>% mutate(site= rep("HS",nrow(demo_trait_high)))
demo_trait_low<-demo_trait_low %>% mutate( site= rep("LS",nrow(demo_trait_low)))
demo_trait<-rbind(demo_trait_high,demo_trait_low)

demo_trait<-demo_trait %>% mutate(merge_ID=paste(demo_trait$site,demo_trait$block,str_to_upper (demo_trait$treat),demo_trait$coord, sep=" "))


func_trait<-func_trait %>% mutate(merge_ID=paste(func_trait$site,func_trait$blockID,func_trait$plotID,func_trait$positionID, sep=" "))

# thickness was measured three times, for more precision
func_trait<-func_trait %>% mutate(thickness=rowMeans(data.frame(func_trait$thickness_1,func_trait$thickness_2,func_trait$thickness_3),na.rm=TRUE))


#converting into numeric the flowers data
demo_trait<-demo_trait %>% mutate(no_flowers_col1= as.numeric(  no_flowers_col1)  ,no_flowers_col10= as.numeric (
 no_flowers_col10) , no_flowers_col2= as.numeric ( no_flowers_col2), 
no_flowers_col3= as.numeric ( no_flowers_col3), no_flowers_col4= as.numeric ( no_flowers_col4), no_flowers_col5= as.numeric (no_flowers_col5),
 no_flowers_col6= as.numeric (no_flowers_col6), no_flowers_col7= as.numeric ( no_flowers_col7),no_flowers_col8= as.numeric (no_flowers_col8), no_flowers_col9= as.numeric ( no_flowers_col9),no_flowers_col9= as.numeric(no_flowers_col9), no_flowers_col11= as.numeric(no_flowers_col11), no_flowers_col12= as.numeric(no_flowers_col12), no_flowers_col13= as.numeric (no_flowers_col13) ,no_flowers_col14= as.numeric ( no_flowers_col14), no_flowers_col15= as.numeric (no_flowers_col15) ,no_flowers_col16= as.numeric (no_flowers_col16) ,no_flowers_col17= as.numeric (no_flowers_col17), no_flowers_col18= as.numeric (no_flowers_col18) ,no_flowers_col19= as.numeric (no_flowers_col19) ,no_flowers_col20= as.numeric (no_flowers_col20), no_flowers_col21= as.numeric (no_flowers_col21) ,no_flowers_col22= as.numeric (no_flowers_col22) ,no_flowers_col23= as.numeric (no_flowers_col23),no_flowers_col24= as.numeric ( no_flowers_col24), no_flowers_col25= as.numeric (no_flowers_col25) ,no_flowers_col26= as.numeric (no_flowers_col26),no_flowers_col27= as.numeric ( no_flowers_col27) ,no_flowers_col28= as.numeric (no_flowers_col28),no_flowers_col29= as.numeric (no_flowers_col29), no_flowers_col30= as.numeric (no_flowers_col30) ,no_flowers_col31= as.numeric (no_flowers_col31) ,no_flowers_col32= as.numeric ( no_flowers_col32), no_flowers_col33= as.numeric ( no_flowers_col33) ,no_flowers_col34= as.numeric (no_flowers_col34) ,no_flowers_col35= as.numeric ( no_flowers_col35), no_flowers_col36= as.numeric ( no_flowers_col36) ,no_flowers_col37= as.numeric (no_flowers_col37) ,no_flowers_col38= as.numeric ( no_flowers_col38), no_flowers_col39= as.numeric ( no_flowers_col39) ,no_flowers_col40= as.numeric (no_flowers_col40) ,no_flowers_col41= as.numeric ( no_flowers_col41), no_flowers_col42= as.numeric (no_flowers_col42) ,no_flowers_col43= as.numeric (no_flowers_col43) ,no_flowers_col44= as.numeric ( no_flowers_col44), no_flowers_col45= as.numeric ( no_flowers_col45) ,no_flowers_col46= as.numeric (no_flowers_col46) ,no_flowers_col47= as.numeric ( no_flowers_col47))

#computing the total number of flowers per individual
demo_trait<-demo_trait %>% 
  rowwise %>% 
  mutate(no_flowers_tt=sum(c_across(c("no_flowers_col1","no_flowers_col10","no_flowers_col2","no_flowers_col3","no_flowers_col4","no_flowers_col5","no_flowers_col6","no_flowers_col7","no_flowers_col8","no_flowers_col9","no_flowers_col9","no_flowers_col11","no_flowers_col12","no_flowers_col13","no_flowers_col14","no_flowers_col15","no_flowers_col16","no_flowers_col17","no_flowers_col18","no_flowers_col19","no_flowers_col20","no_flowers_col21","no_flowers_col22","no_flowers_col23","no_flowers_col24","no_flowers_col25","no_flowers_col26","no_flowers_col27","no_flowers_col28","no_flowers_col29","no_flowers_col30","no_flowers_col31","no_flowers_col32","no_flowers_col33","no_flowers_col34","no_flowers_col35","no_flowers_col36","no_flowers_col37","no_flowers_col38","no_flowers_col39","no_flowers_col40","no_flowers_col41","no_flowers_col42","no_flowers_col43","no_flowers_col44","no_flowers_col45","no_flowers_col46","no_flowers_col47")),na.rm=TRUE))

func_trait$bulknr[is.na(func_trait$bulknr)]<-1
func_trait<-transform(func_trait, dry_mass = `dry_mass`/`bulknr`) 
func_trait<-transform(func_trait, wet_mass = `wet_mass`/`bulknr`) # number of leaves taken into account ) bulknr ( sometimes 2), so transformation to have the mass/ leaf

#sampled quarter = sometimes only 1/4 of the individual is measured. to have an approximation of measurments / indiv, we have to multiply everything by 4 when sampled_quarted="yes"
demo_trait$sampled_quarter<-as.numeric(sub("yes",4,demo_trait$sampled_quarter))
demo_trait$sampled_quarter[is.na(demo_trait$sampled_quarter)]<-1
demo_trait<-transform(demo_trait, no_leaves = `no_leaves`*`sampled_quarter`)

all_trait<-merge(func_trait,demo_trait,by="merge_ID")
all_trait<-merge(all_trait,df,by="merge_ID")

```

sélection des colones que l'on conserve pour la RDA
```{r}
all_trait_pca<-all_trait[all_trait$species %in% c("CN","SP","TP","PS","PL","LM","LV"), ]

for (i in 1:47){
  column=paste("no_flowers_col",i,sep="")
  all_trait_pca[,column]<-NULL
}
all_trait_pca$date.x<-NULL
all_trait_pca$ID.x<-NULL
all_trait_pca$site.x<-NULL
all_trait_pca$species.x<-NULL
all_trait_pca$treat1.x<-NULL
all_trait_pca$treat2.x<-NULL
all_trait_pca$blockID.x<-NULL
all_trait_pca$plotID.x<-NULL
all_trait_pca$positionID.x<-NULL
all_trait_pca$thickness_1<-NULL
all_trait_pca$thickness_2<-NULL
all_trait_pca$thickness_3<-NULL

```
select(-c(var1,var2,...))

```{r}
#Factoshiny(all_trait_pca)

```
```{r}
colnames(all_trait_pca[,c(
  
1,6,9,10,11,12,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,41,42,43,47,51)])
colnames(all_trait_pca[,c(1,8,13,16,20,24,25)])

```
"merge_ID", "remark","block", "treat", "species.y", "coord", "herbivory_leaf"   "herbivory_flower", "nathan_old_new", "tillers_yes_no" ,"date.y","observer","scribe","comment", "site.y","ID.y", "date",  "site",  "species", "treat1.y" ,"treat2.y","plotID.y" ,"positionID.y", "positionID_clean","student","temperature"

"merge_ID","thickness","height_veg_cm","height_rep_cm","petiole_length_mm","herbivory_leaf","herbivory_flower" 


```{r}


index_pca<-which(names(all_trait_pca)%in%c("merge_ID", "remark","block", "treat", "species.y", "coord", "herbivory_leaf" ,  "herbivory_flower", "nathan_old_new", "tillers_yes_no" ,"date.y","observer","scribe","comment", "site.y","ID.y", "date",  "site",  "species", "treat1.y" ,"treat2.y","plotID.y" ,"positionID.y", "positionID_clean","student","temperature") )
quali_sup<-grep("condi",colnames(all_trait_pca))
quanti_sup<-which(names(all_trait_pca)%in%c("merge_ID","thickness","height_veg_cm","height_rep_cm","petiole_length_mm","herbivory_leaf","herbivory_flower" ))


res.PCA<-PCA(all_trait_pca[,-index_pca],quali.sup=c(23),quanti.sup=quanti_sup,graph=FALSE)
plot.PCA(res.PCA,choix='var',title="Graphe des variables de l'ACP")
plotellipses(res.PCA, keepvar=23,invisible=c('ind','ind.sup'),title="Graphe des individus de l'ACP",label =c('quali'))
plotellipses(res.PCA, keepvar=23,invisible=c('ind.sup'),title="Graph of the individuals",label =c('quali'))

dimdesc(res.PCA)
```
NB: les ellipses sont au seuil 95%: seuil de confiance du barycentre

```{r}
index_pca<-which(names(all_trait_pca)%in%c("merge_ID", "remark","block", "treat", "species.y", "coord", "herbivory_leaf" ,  "herbivory_flower", "nathan_old_new", "tillers_yes_no" ,"date.y","observer","scribe","comment", "site.y","ID.y", "date",  "site",  "condi", "treat1.y" ,"treat2.y","plotID.y" ,"positionID.y", "positionID_clean","student","temperature") )


res.PCA<-PCA(all_trait_pca[,-index_pca],quali.sup=c(19),quanti.sup=c(1,8,13,16,20,24,25),graph=FALSE)

plot.PCA(res.PCA,choix='var',title="Graphe des variables de l'ACP")
plotellipses(res.PCA, keepvar=19,invisible=c('ind.sup'),title="Graphe des individus de l'ACP",label =c('quali'))
plotellipses(res.PCA, keepvar=19,invisible=c('ind','ind.sup'),title="Graphe des individus de l'ACP",label =c('quali'))

```

essaie pour mettre un autre moyen pour imputer les valeurs manquante

## PCA with dudi.pca to be able to perform discriminante
#d'après au dessus, 5 dimensions devrait suffir

RDA
```{r}
#$completeObs
column_pca<- c("wet_mass","dry_mass" ,"thickness", "height_veg_cm",  "height_rep_strech_cm" , "height_rep_cm" ,"height_veg_stretch_cm" ,"leaf_length_mm","leaf_width_mm" ,"no_leaves","no_rep_stems","seeds_number.inf", "weight.inf"          ,"weight.seed", "no_flowers_tt"   )  

test<-imputePCA(all_trait_pca[,column_pca],ncp=2)# pour remplacer les NA
my_rda<-rda(test$completeObs~all_trait_pca$condi + Condition(all_trait_pca$species),scale=TRUE,center=TRUE,)

plt1 <- gg_ordiplot(my_rda, groups = all_trait_pca$condi, plot = FALSE)
plt1$plot

```
idée
uscores <- data.frame(dune.pca$CA$u)
uscores1 <- inner_join(rownames_to_column(dune.env), rownames_to_column(data.frame(uscores)), type = "right", by = "rowname")
vscores <- data.frame(dune.pca$CA$v)

dudi.pca:

acp<-dudi.pca(all_trait_pca,scale=F,scannf=F,nf=5)
acp<-dudi.pca(all_trait_pca,scale=F,)

s.label(acp$li, xax = 1, yax = 2)
gcol <- c("red", "blue","yellow","purple","green","black", "blue3","blue4","brown1","brown3","brown4","grey","gold")

s.class(dfxy = acp$li, fac = as.factor(all_trait_pca$condi), col = gcol, xax = 1, yax = 2)
s.corcircle(acp$co,xax=1,yax=2)

s.label(acp$li, xax = 1, yax = 3)
s.label(acp$li, xax = 2, yax = 3)




nipals(d[,c(1,2)])


discr<-discrimin(acp,as.factor(all_trait_pca$condi),scannf=F,nf=4)
plot(discr)
s.label(discr$li, xax = 1, yax = 2)
s.class(dfxy = discr$li, fac = as.factor(all_trait_pca$condi), col = gcol, xax = 1, yax = 2)



```{r}
#covar<- subset(all_trait_pca, select = c(species))
#expl_var<- subset(all_trait_pca, select = c(weight.inf, #veg_height,repr_height, weight.seed,seeds_number.inf))

# Run a partial RDA
#spe.partial.rda <- rda(all_trait_pca$species, expl_var, covar)
```


pairwise correlation
```{r}
ggpairs(all_trait_pca[,c("height_veg_cm", "height_rep_cm","no_leaves","no_rep_stems","seeds_number.inf" ,"weight.seed", "no_flowers_tt")], diag = list("continuous"="blank"))
```

```{r}
pairs(all_trait_pca[,column_pca[1:5]],
      lower.panel = NULL)
pairs(all_trait_pca[,column_pca[6:10]],
      lower.panel = NULL)
pairs(all_trait_pca[,column_pca[11:15]],
      lower.panel = NULL)

pairs(all_trait_pca[,c("height_veg_cm", "height_rep_cm","no_leaves","no_rep_stems","seeds_number.inf" ,"weight.seed", "no_flowers_tt")], lower.panel = NULL)
 
```


#correlation height veg/ rep : demo trait
```{r}
demo_trait<-demo_trait %>%mutate(condi =paste(demo_trait$site,demo_trait$treat,sep=" "))
#competition
demo_trait<-demo_trait %>% mutate(competition = demo_trait$condi)
demo_trait$competition<-str_replace(demo_trait$competition,"HS e","bare")
demo_trait$competition<-str_replace(demo_trait$competition,"HS a","vegetation")
demo_trait$competition<-str_replace(demo_trait$competition,"HS b","vegetation")
demo_trait$competition<-str_replace(demo_trait$competition,"HS f","bare")
demo_trait$competition<-str_replace(demo_trait$competition,"LS a","vegetation")
demo_trait$competition<-str_replace(demo_trait$competition,"LS b","bare")

#temperature
demo_trait<-demo_trait %>% mutate(temperature = demo_trait$condi)
demo_trait$temperature<-str_replace(demo_trait$temperature,"HS e","High warm")
demo_trait$temperature<-str_replace(demo_trait$temperature,"HS a","High warm")
demo_trait$temperature<-str_replace(demo_trait$temperature,"HS b","High ambient")
demo_trait$temperature<-str_replace(demo_trait$temperature,"HS f","High ambient")
demo_trait$temperature<-str_replace(demo_trait$temperature,"LS a","Low ambient")
demo_trait$temperature<-str_replace(demo_trait$temperature,"LS b","Low ambient")



```

which focal species do we keep
```{r}
species=c("plalan","cyncri","hypmac","pimsax","cennig","tripra","leuvul","luzmul", "sildio", "sucpra")
counts<-c()
  for (i in 1:10){
  counts<-c(counts,colSums(!is.na(demo_trait[demo_trait$species==species[i],]))["height_rep_cm"])
  }

ggplot(data=data.frame(species,counts),aes(x=species,y=counts)) +geom_bar(stat="identity")
```
we leave apart HM SD and CC
```{r}
demo_trait<-demo_trait[demo_trait$species %in% c("plalan","pimsax","cennig","tripra","leuvul","luzmul", "sucpra"), ]
```


```{r}
hveg_hrep1<-ggplot(data = demo_trait, aes(x = height_veg_cm, y = height_rep_cm, col = competition)) +
  geom_point(size=1) +
  geom_smooth(method="lm")+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "Vegetative height",
       y = "Reproductive height")

hveg_hrep2<-ggplot(data = demo_trait, aes(x = height_veg_cm, y = height_rep_cm, col = site)) +
  geom_point(size=1) +
  geom_smooth(method="lm")+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "Vegetative height",
       y = "Reproductive height")

hveg_hrep3<-ggplot(data = demo_trait, aes(x = height_veg_cm, y = height_rep_cm, col = temperature)) +
  geom_point(size=1) +
  geom_smooth(method="lm")+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "Vegetative height",
       y = "Reproductive height")




combined_hveg_hrep <- hveg_hrep1 + hveg_hrep2 + hveg_hrep3 + plot_layout(ncol = 2)

combined_hveg_hrep

```

```{r}
glmm_vegh_reph_c<-lmer(height_rep_cm~height_veg_cm*competition+(1|species)+(1|block),data=demo_trait)
glmm_vegh_reph_t<-lmer(height_rep_cm~height_veg_cm*temperature+(1|species)+(1|block),data=demo_trait)
g_vegh_reph_c<- interact_plot(glmm_vegh_reph_c,pred=height_veg_cm,modx=competition,interval =TRUE, int.type="confidence")
g_vegh_reph_t<- interact_plot(glmm_vegh_reph_t,pred=height_veg_cm,modx=temperature,interval =TRUE, int.type="confidence")
ggarrange(g_vegh_reph_c, g_vegh_reph_t, ncol=1, nrow=2)
```

```{r}
nol_nof1<-ggplot(data = demo_trait, aes(x = no_flowers_tt, y = no_leaves, col = site)) +
  geom_point(size=1) +
  geom_smooth(method='lm')+
  xlim(0,30)+
  ylim(0,250)+
  labs(title = "effect of site on trade off vegetative/reproductive development",
       x = "number flowers",
       y = "number leaves")

nol_nof2<-ggplot(data = demo_trait, aes(x = no_flowers_tt, y = no_leaves, col = temperature)) +
  geom_point(size=1) +
  geom_smooth(method='lm')+
  xlim(0,30)+
  ylim(0,250)+
  labs(title = "effect of temperature on trade off vegetative/reproductive development",
       x = "number flowers",
       y = "number leaves")
nol_nof3<-ggplot(data = demo_trait, aes(x = no_flowers_tt, y = no_leaves, col = competition)) +
  geom_point(size=1) +
  geom_smooth(method='lm')+
  xlim(0,30)+
  ylim(0,250)+
  labs(title = "effect of competition on trade off vegetative/reproductive development",
       x = "number flowers",
       y = "number leaves")
nol_nof4<-ggplot(data = demo_trait, aes(x = no_flowers_tt, y = no_leaves, col = condi)) +
  geom_point(size=1) +
  geom_smooth(method='lm')+
  xlim(0,30)+
  ylim(0,250)+
  labs(title = "effect of species on trade off vegetative/reproductive development",
       x = "number flowers",
       y = "number leaves")


combined_nol_nof <- nol_nof1 + nol_nof2 + nol_nof3+nol_nof4+ plot_layout(ncol = 2)

combined_nol_nof
```

## number seeds/weigh seeds: seems not good
```{r}
wps_sn1<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = seeds_number.inf, col = treat2.y)) +
  geom_point(size=1) +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of competition on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "seeds number/infructescence")

wps_sn2<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = seeds_number.inf, col = site)) +
  geom_point(size=1) +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of site on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "seeds number/infructescence")

wps_sn3<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = seeds_number.inf, col = temperature)) +
  geom_point(size=1) +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of temperature on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "seeds number/infructescence")


combined_wps_sn <- wps_sn1 + wps_sn2 + wps_sn3+ plot_layout(ncol = 2)
combined_wps_sn

```

## weight per seed/ veg height: good!
```{r}
wps_vegh1<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = height_veg_cm, col = treat2.y)) +
  geom_point(size=1) +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of competition on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_vegh2<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = height_veg_cm, col = site)) +
  geom_point(size=1) +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of site on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_vegh3<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = height_veg_cm, col = temperature)) +
  geom_point(size=1) +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of temperature on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_vegh4<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = height_veg_cm, col = condi)) +
  geom_point(size=1) +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

combined_wps_vegh <- wps_vegh1 + wps_vegh2 + wps_vegh3+ wps_vegh4 + plot_layout(ncol = 2)

combined_wps_vegh

```
all_trait_pca, aes(x = weight.seed, y = height_veg_cm, col = treat2.y)
```{r}
glmm_vegh_reph<-lmer(height_veg_cm~weight.seed*treat2.y+(1|species)+(1|block),data=all_trait_pca)
interact_plot(glmm_vegh_reph,pred=weight.seed,modx=treat2.y,interval =TRUE, int.type="confidence")
```
## repr height weight seed

```{r}



wps_reph1<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = height_rep_cm, col = treat2.y)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of competition on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_reph2<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = height_rep_cm, col = site)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of site on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_reph3<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = height_rep_cm, col = temperature)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of temperature on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_reph4<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = height_rep_cm, col = condi)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "reproductiv height")

combined_wps_reph <- wps_reph1 + wps_reph2 + wps_reph3+ wps_reph4 + plot_layout(ncol = 2)

combined_wps_reph

```
all_trait_pca, aes(x = weight.seed, y = height_rep_cm, col = treat2.y)
```{r}
glmm_vegh_reph<-lmer(weight.seed~height_rep_cm*site+(1|species)+(1|block),data=all_trait_pca)
interact_plot(glmm_vegh_reph,pred=height_rep_cm,modx=site,interval =TRUE, int.type="confidence")
```


## wet/dry mass weight seed
```{r}
wps_dm1<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = dry_mass, col = treat2.y)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of competition on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_dm2<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = dry_mass, col = site)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of site on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_dm3<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = dry_mass, col = temperature)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of temperature on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_dm4<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = dry_mass, col = condi)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

combined_wps_dm <- wps_dm1 + wps_dm2 + wps_dm3+ wps_dm4 + plot_layout(ncol = 2)

combined_wps_dm

```


## wet/dry mass?

## no flower/ weight per seed
```{r}



wps_nof1<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = no_flowers_tt, col = treat2.y)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of competition on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "number of flowers")

wps_nof2<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = no_flowers_tt, col = site)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of site on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "number of flowers")

wps_nof3<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = no_flowers_tt, col = temperature)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of temperature on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "number of flowers")

wps_nof4<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = no_flowers_tt, col = condi)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "number of flowers")

combined_wps_nof<- wps_nof1 + wps_nof2 + wps_nof3+ wps_nof4 + plot_layout(ncol = 2)

combined_wps_nof

```
 all_trait_pca, aes(x = weight.seed, y = no_flowers_tt, col = treat2.y
```{r}
glmm_vegh_reph<-lmer(no_flowers_tt~weight.seed*treat2.y+(1|species)+(1|block),data=all_trait_pca)
interact_plot(glmm_vegh_reph,pred=weight.seed,modx=treat2.y,interval =TRUE, int.type="confidence")
```
## no leaves/ weight per seed
```{r}



wps_nol1<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = no_leaves, col = treat2.y)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of competition on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_nol2<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = no_leaves, col = site)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of site on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_nol3<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = no_leaves, col = temperature)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of temperature on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_nol4<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = no_leaves, col = condi)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

combined_wps_nol<- wps_nol1 + wps_nol2 + wps_nol3+ wps_nol4 + plot_layout(ncol = 2)

combined_wps_nol

```

## no repr stems/ weight per seed
## leaf thicknes, length, width, wps..
```{r}



wps_ll1<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = leaf_length_mm, col = treat2.y)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of competition on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_ll2<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = leaf_length_mm, col = site)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of site on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_ll3<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = leaf_length_mm, col = temperature)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of temperature on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

wps_ll4<-ggplot(data = all_trait_pca, aes(x = weight.seed, y = leaf_length_mm, col = condi)) +
  geom_point() +
  xlim(0,0.003)+
  geom_smooth(method='lm')+
  labs(title = "effect of treatments on trade off vegetative/reproductive development",
       x = "weight/seed",
       y = "vegetative height")

combined_wps_ll<- wps_ll1 + wps_ll2 + wps_ll3+ wps_ll4 + plot_layout(ncol = 2)

combined_wps_ll

```

# what to do next : try to write a code using glmm to study these correlations
## weight per seed/ veg height: good!

library(lme4)
fit <- glmer(resp.var ~ cont.var:cat.var + (1 | rand.eff),
             data = sample.data, family = poisson)
             
library(jtools)
interact_plot(fit, pred = cont.var, modx = cat.var)

```{r}
glmm_wps_vh<-lmer(weight.seed~height_veg_cm*treat2.y+(1|species)+(1|block),data=all_trait)
interact_plot(glmm_wps_vh,pred=height_veg_cm,modx=treat2.y,interval =TRUE, int.type="confidence")
```
augment(mod, interval = "confidence") |> 
  ggplot(aes(x = body_mass_g, y = bill_length_mm)) +
  geom_point() +
  geom_ribbon(aes(ymin = .lower, ymax = .upper), alpha = .3)+
  geom_line(aes(y = .fitted))
```{r}
test_lm<-lm(weight.seed~height_veg_cm*treat2.y,data=all_trait_pca)
```
  
```{r}
augment(test_lm, interval = "confidence") |> 
  ggplot(aes(x = height_veg_cm, y = weight.seed)) +
  geom_point() +
  geom_ribbon(aes(ymin = .lower, ymax = .upper), alpha = .3)+
  geom_line(aes(y = .fitted))
```
```{r}
plot(predictorEffects(glmm_wps_vh))

```
mydf <- ggpredict(m.laden.1, terms = c("temp [all]", "Bioma"))

ggplot(mydf, aes(x, predicted)) +
  geom_point(data=myds, aes(temp, ladenant, color = Bioma), alpha = 0.5) + 
  geom_line(aes(color = group)) +
  labs(x = "temp", y = "ladenant")
  
glmm_wps_vh<-lmer(weight.seed~height_veg_cm*treat2.y+(1|species)+(1|block),data=all_trait)

```{r}

mydf <- ggpredict(glmm_wps_vh, terms = c("height_veg_cm", "treat2.y"))

ggplot(mydf, aes(x, predicted)) +
  geom_point(data=all_trait, aes(height_veg_cm, weight.seed, color = treat2.y), alpha = 0.5) + 
  geom_line(aes(color = group)) +
  labs(x = "vegetativ height", y = "weight per seed")
```


